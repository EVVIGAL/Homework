using System;
using System.Collections.Generic;

namespace Homework_2
{
	internal class Program
	{
		static void Main(string[] args)
		{
			Platoon firstPlatoon = new("Korea");
			Platoon secondPlatoon = new("Japan");

			while (firstPlatoon.CheckForSoldiers() == true && secondPlatoon.CheckForSoldiers() == true)
			{
				Console.Clear();
				firstPlatoon.ShowInfo(0, 0);
				secondPlatoon.ShowInfo(30, 0);
				Console.SetCursorPosition(0, 7);
				secondPlatoon.TakeDamageByRandomUnit(firstPlatoon.GetRandomUnitForShoot().DealDamage());

				if (secondPlatoon.CheckForSoldiers() == true)
					firstPlatoon.TakeDamageByRandomUnit(secondPlatoon.GetRandomUnitForShoot().DealDamage());
			}

			if (firstPlatoon.CheckForSoldiers() == true)
				Console.WriteLine($"Победил первый взвод!");
			else if (secondPlatoon.CheckForSoldiers() == true)
				Console.WriteLine($"Победил второй взвод!");

			Console.ReadKey();
		}
	}

	class Platoon
	{
		Random random = new();
		private List<Unit> _units = new();

		public Platoon(string country)
		{
			Country = country;
			_units.Add(new Infantry());
			_units.Add(new Infantry());
			_units.Add(new Infantry());
			_units.Add(new Sniper());
			_units.Add(new Grenadier());
		}

		public string Country { get; private set; }

		public Unit GetRandomUnitForShoot()
		{
			Unit unit = GetRandomUnit();
			Console.WriteLine($"Стреляет {unit.GetName()} из {Country}");
			return unit;
		}

		public bool CheckForSoldiers()
		{
			bool isExist = true;

			if (_units.Count == 0)
				isExist = false;

			return isExist;
		}

		public void ShowInfo(int xPosition, int yPosition)
		{
			Console.SetCursorPosition(xPosition, yPosition);
			Console.WriteLine(Country);
			yPosition++;

			foreach (Unit unit in _units)
			{
				Console.SetCursorPosition(xPosition, yPosition);
				yPosition++;
				Console.WriteLine(unit.GetName() + " - " + unit.GetHealth());
			}
		}

		public void TakeDamageByRandomUnit(int damage)
		{
			Unit unit = GetRandomUnit();
			unit.TakeDamage(damage);

			if (unit.GetHealth() <= 0)
			{
				_units.Remove(unit);
				Console.WriteLine($"{unit.GetName()} из {Country} уничтожен");
				Console.ReadKey();
			}
			else
			{
				Console.WriteLine($"{unit.GetName()} из {Country} получил {damage} урона");
				Console.ReadKey();
			}
		}

		private Unit GetRandomUnit()
		{
			int selectedUnit = random.Next(0, _units.Count);
			Unit unit = _units[selectedUnit];
			return unit;
		}
	}

	abstract class Unit
	{
		protected string Name;
		protected int Damage;
		protected int Health;

		public virtual int DealDamage()
		{
			Console.WriteLine($"{Name} наносит {Damage} урона.");
			Console.ReadKey();
			return Damage;
		}

		public int GetHealth()
		{
			return Health;
		}

		public string GetName()
		{
			return Name;
		}

		public void TakeDamage(int damage)
		{
			Health -= damage;
		}
	}

	class Infantry : Unit
	{
		public Infantry()
		{
			Name = "Пехотинец";
			Damage = 20;
			Health = 100;
		}
	}

	class Sniper : Unit
	{
		public Sniper()
		{
			Name = "Снайпер";
			Damage = 80;
			Health = 80;
		}
	}

	class Grenadier : Unit
	{
		private Random _random = new();
		private int _minDamageCounter = 1;
		private int _maxDamageCounter = 4;

		public Grenadier()
		{
			Name = "Гренадёр";
			Damage = 30;
			Health = 60;
		}

		public override int DealDamage()
		{
			int damage = Damage * _random.Next(_minDamageCounter, _maxDamageCounter);
			Console.WriteLine($"{Name} наносит {damage} урона.");
			Console.ReadKey();
			return damage;
		}
	}
}
