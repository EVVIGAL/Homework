using System;
using System.Collections.Generic;

namespace Homework_2
{
	internal class Program
	{
		static void Main(string[] args)
		{
			bool isWorking = true;
			Merchant merchant = new Merchant();
			Customer customer = new Customer();

			while (isWorking)
			{
				Console.Clear();
				Console.WriteLine("Вы в магазине. Введите номер команды:");
				Console.WriteLine("1 - Посмотреть товары у продавца\n2 - Посмотреть свою корзину\n3 - Купить товар\n4 - Цены\n5 - Выйти");
				string userInput = Console.ReadLine();

				switch (userInput)
				{
					case "1":
						merchant.ShowInfo();
						break;
					case "2":
						customer.ShowInfo();
						break;
					case "3":
						Trade(customer, merchant);
						break;
					case "4":
						merchant.ShowPrice();
						break;
					case "5":
						isWorking = false;
						break;
				}
			}
		}

		static void Trade(Customer customer, Merchant merchant)
		{
			List<Product> products = merchant.GiveList();
			Console.WriteLine("Какой товар купить?");
			string name = Console.ReadLine();
			Console.WriteLine("Какое количество товара купить?");
			string userInput = Console.ReadLine();
			int quantity = customer.ConvertToInt(userInput);

			for (int i = 0; i < products.Count; i++)
			{
				if (products[i].Name == name && products[i].Quantity >= quantity && customer.CheckMoney() >= products[i].Value * quantity)
				{
					merchant.SellProduct(products[i], i, quantity);
					customer.TakeProduct(products[i], quantity);
					Console.WriteLine("Товар куплен.");
					Console.ReadKey();
				}
				else if (products[i].Name == name && products[i].Quantity <= quantity && customer.CheckMoney() >= products[i].Value * quantity)
				{
					Console.WriteLine("Нет такого товара или его недостаточно.");
					Console.ReadKey();
				}
				else if (products[i].Name == name && products[i].Quantity >= quantity && customer.CheckMoney() <= products[i].Value * quantity)
				{
					Console.WriteLine("У Вас недостаточно денег");
					Console.ReadKey();
				}
			}
		}
	}

	class Person
	{
		protected List<Product> Products = new List<Product>();

		public Person()
		{

		}

		public int Money { get; protected set; }

		public int CheckMoney()
        {
			return Money;
        }

		public List<Product> GiveList()
		{
			List<Product> products = new List<Product>();
			int maxQuantity = 0;

			foreach (Product product in Products)
				maxQuantity += 1;

			products = Products.GetRange(0, maxQuantity);
			return products;
		}

		public void ShowInfo()
		{
			Console.WriteLine($"\n{Money} денег\n");

			for (int i = 0; i < Products.Count; i++)
				Console.WriteLine($"{Products[i].Name} x {Products[i].Quantity}");

			Console.ReadKey();
		}

		public int ConvertToInt(string userInput)
		{
			int number;
			bool success = int.TryParse(userInput, out number);

			if (success == false)
			{
				Console.WriteLine("Ошибка ввода.");
				Console.ReadKey();
			}

			return number;
		}
	}

	class Merchant : Person
	{
		public Merchant()
		{
			Money = 0;
			Products.Add(new Product("Apple", 32, 4));
			Products.Add(new Product("Book", 3, 150));
			Products.Add(new Product("Chair", 1, 780));
			Products.Add(new Product("Pen", 98, 12));
			Products.Add(new Product("Sword", 1, 999));
			Products.Add(new Product("Shield", 2, 560));
		}

		private void TakeMoney(Product product, int quantity)
		{
			Money += product.Value * quantity;
		}
		public void ShowPrice()
		{
			for (int i = 0; i < Products.Count; i++)
				Console.WriteLine($"{Products[i].Name} -- {Products[i].Value} денег за штуку");

			Console.ReadKey();
		}

		public void SellProduct(Product product, int indexOfProduct, int quantity)
		{
			Products.RemoveAt(indexOfProduct);
			Products.Insert(indexOfProduct, new Product(product.Name, product.Quantity - quantity, product.Value));
			TakeMoney(product, quantity);
		}
	}

	class Customer : Person
	{
		public Customer(int money = 1000)
		{
			Money = money;
		}

		private void GiveMoney(Product product, int quantity)
		{
			Money -= quantity * product.Value;
		}

		public void TakeProduct(Product product, int quantity)
		{
			for (int i = 0; i < Products.Count; i++)
			{
				if (product.Name == Products[i].Name)
				{
					quantity += Products[i].Quantity;
					Products.RemoveAt(i);
                }
            }

			Products.Add(new Product(product.Name, quantity, product.Value));
			GiveMoney(product, quantity);
		}
	}

	class Product
	{
		public Product(string name = "Unknown product", int quantity = 1, int value = 10)
		{
			Name = name;
			Quantity = quantity;
			Value = value;
		}

		public string Name { get; private set; }

		public int Value { get; private set; }

		public int Quantity { get; private set; }
	}
}
